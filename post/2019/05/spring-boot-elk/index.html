<!doctype html><html class=no-js lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>spring boot项目集成elk收集项目日志 - SimonDing 的博客</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content>
<meta property="og:title" content="spring boot项目集成elk收集项目日志">
<meta property="og:description" content="项目进行到一定时候我们会希望对系统的日志进行分析，特别是生产环境的日志。以便随时了解系统的运行状态。
elk代表elasticsearch、logstash和kibana，是最为成熟的一套日志收集平台。logstash负责收集日志，elasticsearch负责存储日志和对日志进行索引，kibana负责日志的展示。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://simonding.com/post/2019/05/spring-boot-elk/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2019-05-16T01:31:13+08:00">
<meta property="article:modified_time" content="2019-05-16T01:31:13+08:00">
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-106746611-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<div class=container>
<div class=logo>
<a class=logo__link href=/ title="SimonDing 的博客" rel=home>
<div class=logo__title>SimonDing 的博客</div>
<div class=logo__tagline>韶华易逝，只争朝夕</div>
</a>
</div>
<nav class=menu>
<button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span>
</button>
<ul class=menu__list>
<li class=menu__item>
<a class=menu__link href=/>
<span class=menu__text>主页</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=https://www.instagram.com/simon_ding_/ target=_blank>
<span class=menu__text>Instagram</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=https://500px.me/simonding target=_blank>
<span class=menu__text>500px</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/about/>
<span class=menu__text>关于</span>
</a>
</li>
</ul>
</nav>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>spring boot项目集成elk收集项目日志</h1>
<div class="post__meta meta">
<div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
<time class=meta__text datetime=2019-05-16T01:31:13>2019-05-16</time>
</div>
<div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%E7%BC%96%E7%A8%8B/ rel=category>编程</a>
</span>
</div><span class=meta__text>&emsp; 共 545 字 </span>
</div>
</header>
<div class="post__toc toc">
<div class=toc__title>目录</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#搭建elk环境>搭建elk环境</a>
<ul>
<li><a href=#配置>配置</a></li>
<li><a href=#部署elk>部署elk</a></li>
</ul>
</li>
<li><a href=#spring-boot配置>spring boot配置</a></li>
</ul>
</nav>
</div>
</div>
<div class="content post__content clearfix">
<p>项目进行到一定时候我们会希望对系统的日志进行分析，特别是生产环境的日志。以便随时了解系统的运行状态。</p>
<p>elk代表elasticsearch、logstash和kibana，是最为成熟的一套日志收集平台。logstash负责收集日志，elasticsearch负责存储日志和对日志进行索引，kibana负责日志的展示。</p>
<h2 id=搭建elk环境>搭建elk环境</h2>
<h3 id=配置>配置</h3>
<p>我们使用docker和docker-compose来部署elk平台，docker-compose文件如下：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e>##elk.yml</span>
<span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.0&#34;</span>
<span style=color:#f92672>services</span>:
    <span style=color:#f92672>elasticsearch</span>:
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>elasticsearch:7.0.1</span>
        <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
        <span style=color:#f92672>ports</span>:
            - <span style=color:#ae81ff>9200</span>:<span style=color:#ae81ff>9200</span>
            - <span style=color:#ae81ff>9300</span>:<span style=color:#ae81ff>9300</span>
        <span style=color:#f92672>environment</span>:
            - <span style=color:#ae81ff>discovery.type=single-node</span>
        <span style=color:#f92672>volumes</span>:
            - <span style=color:#ae81ff>/srv/elasticsearch:/usr/share/elasticsearch/data</span>
    <span style=color:#f92672>logstash</span>:
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>logstash:7.0.1</span>
        <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
        <span style=color:#f92672>ports</span>:
            - <span style=color:#ae81ff>5000</span>:<span style=color:#ae81ff>5000</span>
            - <span style=color:#ae81ff>9600</span>:<span style=color:#ae81ff>9600</span>
        <span style=color:#f92672>volumes</span>:
            - <span style=color:#ae81ff>./config/logstash/pipeline.conf:/usr/share/logstash/pipeline/logstash.conf</span>
    <span style=color:#f92672>kibana</span>:
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>kibana:7.0.1</span>
        <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
        <span style=color:#f92672>ports</span>:
            - <span style=color:#ae81ff>5601</span>:<span style=color:#ae81ff>5601</span>
        <span style=color:#f92672>environment</span>:
            - <span style=color:#ae81ff>ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span>
            - <span style=color:#ae81ff>SERVER_NAME=kibana</span>
            - <span style=color:#ae81ff>SERVER_HOST=&#34;0&#34;</span>

</code></pre></div><p>我们的logstash配置pipeline如下(./config/logstash/pipeline.conf)：</p>
<pre><code class=language-conf data-lang=conf>input {
    tcp {
        port =&gt; 5000
        codec =&gt; &quot;json&quot;
        type =&gt; &quot;prod&quot;
    }
}

filter {
    json {
        source =&gt; &quot;_source&quot;
    }
}

output {
    elasticsearch {
        hosts =&gt; &quot;elasticsearch:9200&quot;
    }
}
</code></pre><h3 id=部署elk>部署elk</h3>
<p>使用docker-compose部署项目：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker-compose -f elk.yml pull
docker-compose -f elk.yml up -d
</code></pre></div><p>这样就装好了elk平台，访问 http://localhost:5601 可以看到kibana的web管理界面。</p>
<h2 id=spring-boot配置>spring boot配置</h2>
<p>jhipster的项目默认集成了logstash支持，只需要开启就可以了，修改下面几个参数：</p>
<pre><code class=language-properties data-lang=properties>jhipster.logging.logstash.enabled = true
jhipster.logging.logstash.host = localhost  #logstash所在主机
jhipster.logging.logstash.port = 5000 #配置监听的tcp端口
</code></pre><p>启动项目，在kibana里建立索引，即可以看到生成的log数据了。</p>
</div>
</article>
</main>
<div class="authorbox clearfix">
<figure class=authorbox__avatar>
<img alt="Simon Ding avatar" src=/img/avatar.png class=avatar height=90 width=90>
</figure>
<div class=authorbox__header>
<span class=authorbox__name></span>
</div>
<div class=authorbox__description>
韶华易逝，只争朝夕
</div>
</div>
<nav class="post-nav flex">
<div class="post-nav__item post-nav__item--prev">
<a class=post-nav__link href=/post/2019/02/my-home-network/ rel=prev><span class=post-nav__caption>«&#8201;上一篇</span><p class=post-nav__post-title>我自己的家里的网络环境</p></a>
</div>
<div class="post-nav__item post-nav__item--next">
<a class=post-nav__link href=/post/2019/05/zsh-fish/ rel=next><span class=post-nav__caption>下一篇&#8201;»</span><p class=post-nav__post-title>我抛弃了zsh，拥抱了fish</p></a>
</div>
</nav>
<section class=comments>
<script src=https://utteranc.es/client.js repo=simon-ding/blog-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</section>
</div>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2021 Simon Ding.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>主題</span>
</div>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_site_pv>本站总访问量<span id=busuanzi_value_site_pv></span>次</span>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>