<!doctype html><html class=no-js lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Go 语言 QT 开发踩坑 - SimonDing 的博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Go 语言 QT 开发踩坑"><meta property="og:description" content="最近为公司开发了一个工具来简化一些繁琐的操作。试用了很多个 GUI 库之后，最终转到了 qt 上。工具使用了 therecipe/qt 项目的qt绑定。
go语言有好几个qt绑定的库，但是大部分都已经不在维护了，之后这个 therecipe/qt 项目目前还在积极的维护。开发者也比较活跃。中间遇到了问题，在github提了个 issue 开发者也很快回复了。
但是这个库目前还处于积极开发的状态，文档奇缺。英文文档都很少，更别提中文文档了。在谷歌里搜索这个库，几乎找不到一个像样的demo的例子。
github主页上有详细的安装方法，但是由于中国的网络环境。安装过程并不是很顺畅。其他的基本上都要看作者给的代码示例了。
我下面的坑都是在 Mac 环境下的，windows下可以做参考"><meta property="og:type" content="article"><meta property="og:url" content="https://simonding.com/post/2019/09/go-qt/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-09-30T23:23:48+08:00"><meta property="article:modified_time" content="2019-09-30T23:23:48+08:00"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-106746611-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="SimonDing 的博客" rel=home><div class="logo__item logo__text"><div class=logo__title>SimonDing 的博客</div><div class=logo__tagline>韶华易逝，只争朝夕</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>主页</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=https://500px.me/simonding><span class=menu__text>500px</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Go 语言 QT 开发踩坑</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2019-09-30T23:23:48+08:00>2019-09-30</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E7%BC%96%E7%A8%8B/ rel=category>编程</a></span></div><span class=meta__text>&emsp; 共 1032 字</span></div></header><div class="post__toc toc"><div class=toc__title>目录</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#坑一安装>坑一：安装</a><ul><li><a href=#xcode>Xcode</a></li><li><a href=#qt>QT</a></li><li><a href=#安装-therecipeqt-绑定>安装 therecipe/qt 绑定</a></li></ul></li><li><a href=#打包和交叉编译>打包和交叉编译</a><ul><li><a href=#项目打包问题>项目打包问题</a></li><li><a href=#交叉编译问题>交叉编译问题</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><p>最近为公司开发了一个工具来简化一些繁琐的操作。试用了很多个 GUI 库之后，最终转到了 qt 上。工具使用了 <a href=https://github.com/therecipe/qt>therecipe/qt</a> 项目的qt绑定。</p><p>go语言有好几个qt绑定的库，但是大部分都已经不在维护了，之后这个 <a href=https://github.com/therecipe/qt>therecipe/qt</a> 项目目前还在积极的维护。开发者也比较活跃。中间遇到了问题，在github提了个 issue 开发者也很快回复了。</p><p>但是这个库目前还处于积极开发的状态，文档奇缺。英文文档都很少，更别提中文文档了。在谷歌里搜索这个库，几乎找不到一个像样的demo的例子。</p><p>github主页上有详细的安装方法，但是由于中国的网络环境。安装过程并不是很顺畅。其他的基本上都要看作者给的代码示例了。</p><p><strong>我下面的坑都是在 Mac 环境下的，windows下可以做参考</strong></p><h2 id=坑一安装>坑一：安装</h2><p>MacOS 上安装qt绑定，基本是按这个文档 <a href=https://github.com/therecipe/qt/wiki/Installation-on-macOS>Installation on macOS</a>，不过中间有好多坑要注意。</p><h3 id=xcode>Xcode</h3><p>需要安装Xcode，虽然官方给的教程好像用command line也可以，但是坑较多。需要改好多东西。我最后还是安装Xcode一次性解决。</p><h3 id=qt>QT</h3><p>安装qt按照 <a href=https://github.com/therecipe/qt/wiki/Installation-on-macOS>Installation on macOS</a> 来就可以。注意的是homebrew安装需要设置环境变量 QT_HOMEBREW=true，如果你不需要iOS和Android的支持，安装homebrew版本即可。我个人目前使用的就是homebrew版本的qt。</p><p>截止目前，项目官方支持的版本是Qt 5.13.0，其他版本需要更改一些环境变量。我没有测试过。</p><h3 id=安装-therecipeqt-绑定>安装 therecipe/qt 绑定</h3><p>安装官方文档的安装方式，还算简单</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>go get -u -v -tags<span style=color:#f92672>=</span>no_env github.com/therecipe/qt/cmd/...
</span></span><span style=display:flex><span><span style=color:#66d9ef>$(</span>go env GOPATH<span style=color:#66d9ef>)</span>/bin/qtsetup
</span></span></code></pre></div><p>不过第一 go get 操作会下载一下 golang的包，自行做好命令行翻墙的准备。</p><p>到这一步，如果一切顺利的话，应该可以正常编译出几个测试程序。就可以开始写程序了。</p><h2 id=打包和交叉编译>打包和交叉编译</h2><p>项目代码是没有任何代码使用方式的文档的，大部分时间要参照作者 examples目录下的示例代码。推荐使用go module来管理第三方依赖。</p><h3 id=项目打包问题>项目打包问题</h3><p>写好代码之后，测试代码是否能正常运行，就要把代码打包成可执行性文件。具体打包操作是最坑的一点。</p><p>在我踩过无数坑之后，一个大概可以的打包流程如下：</p><ul><li>下载依赖</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>go mod download 
</span></span></code></pre></div><ul><li>由于中国特殊的网络环境，并不能按照官方的教程一步步来走。还好作者给出了一个解决办法 <a href=https://github.com/therecipe/qt/issues/755#issuecomment-455248057>more info here, such as how to work around the GFW</a>。简单来说就是执行下面一条命令</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>go get -u -v github.com/therecipe/qt/cmd/qtsetup <span style=color:#f92672>&amp;&amp;</span> go get -u -v github.com/therecipe/qt/cmd/...
</span></span></code></pre></div><ul><li>therecipe/qt 打包方式是使用vendor目录打包，而不是使用最新的 go mod。我们要把所有的依赖放到vendor目录下</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>go mod vendor
</span></span></code></pre></div><ul><li>克隆环境依赖</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ./vendor/github.com/therecipe <span style=color:#f92672>&amp;&amp;</span> git clone https://github.com/therecipe/env_<span style=color:#66d9ef>$(</span>go env GOOS<span style=color:#66d9ef>)</span>_amd64_512.git <span style=color:#f92672>&amp;&amp;</span> cd ../../..
</span></span></code></pre></div><p><strong>这一步挺重要的要不然会打包不成功</strong></p><ul><li>打包</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>qtdeploy test desktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#或者</span>
</span></span><span style=display:flex><span>qtdeploy build dektop
</span></span></code></pre></div><h3 id=交叉编译问题>交叉编译问题</h3><p><em>&mdash;待填坑&mdash;</em></p></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="Simon Ding avatar" src=/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>关于 Simon Ding</span></div><div class=authorbox__description>韶华易逝，只争朝夕</div></div><section class=comments><script src=https://utteranc.es/client.js repo=simon-ding/blog-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 Simon Ding.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>